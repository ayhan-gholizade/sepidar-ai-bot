from bale import Bot, Message
import google.generativeai as gg
import asyncio

# ุชูฺฉูโูุง
BALE_TOKEN = "350738185:BWcp9YMhS9njLRkYLlYFcAQMiA5Q8JTN7CY"
GEMINI_API_KEY = "AIzaSyBhbiOFG9-7z8ELNqizVWeoJnZmONKgjxY"

# ูพฺฉุฑุจูุฏ Gemini
gg.configure(api_key=GEMINI_API_KEY)
model = gg.GenerativeModel('gemini-2.0-flash')

# ุญุงูุธู ฺุช ุจุฑุง ูุฑ ฺฉุงุฑุจุฑ
chat_sessions = {}
user_prompt_sent = {}

# ุณุงุฎุช ุฑุจุงุช
bot = Bot(BALE_TOKEN)

@bot.event
async def on_message(message: Message):
    user_id = str(message.chat.id)
    user_text = message.content

    # ูพุงุณุฎ ุจู /start
    if user_text == "/start":
        return await message.reply("ุณูุงู ๐\nุจู ุฑุจุงุช ุงุฆุชูุงู ุณูพุฏุงุฑ ุฎูุด ุงููุฏ! ๐ฟ\nูุฑ ุณูุงู ุฏุฑุจุงุฑู ููุงุดฺฏุงู ูพฺููุด ุฏุงุฑ ุจูพุฑุณ!")

    # ูพุงุณุฎ ุจู /help
    if user_text == "/help":
        return await message.reply("๐ ุฑุงูููุง:\n- /start: ุดุฑูุน ฺฏูุชฺฏู\n- ุณูุงู ุจูพุฑุณ ุชุง ุฌูุงุจ ุจุฏู!\n- ูุฑ ุณูุงู ฺฉู ุฏุฑุจุงุฑู  ููุงุดฺฏุงู ุฏุงุดุช ุจูพุฑุณ ๐")

    # ูพุงู ุฏุฑ ุญุงู ูพุงุณุฎโุฏู
    await message.reply("ุฏุฑ ุญุงู ุงุฌุงุฏ ูพุงุณุฎ ...")

    # ุณุงุฎุช ุง ุจุงุฒุงุจ ฺุช Gemini ุจุฑุง ฺฉุงุฑุจุฑ
    if user_id not in chat_sessions:
        chat_sessions[user_id] = model.start_chat()
    chat = chat_sessions[user_id]

    # ุณุงุฎุช ูพุฑุงููพุช ูุนุฑู ููุท ุจุงุฑ ุงูู
    if user_id in user_prompt_sent:
        prompt = user_text
    else:
        user_prompt_sent[user_id] = True
        prompt = f"""ุชู ุงูุงู ุฑุจุงุช ููุดููุฏ ุงุฆุชูุงู ุณูพุฏุงุฑ ูุณุช. ุฎุจ ุฏูุช ฺฉู ู ฺฉุงุฑูุง ฺฉู ุจูุช ูฺฏู ุฑู ุฎู ุฏุฑุณุช ู ุฏูู ุงูุฌุงู ุจุฏู ฺูู ุฎุฑูุฌ ฺฉู ุชู ุจูู ุฎูุงู ุฏุงุฏ ุฎู ุจุฑุงู ูููู. ุงุฆุชูุงู ุณูพุฏุงุฑ ุงุณู ู ฺฏุฑูู ุชู ูุฏุฑุณู  ุนูุงูู ุญู 3 ูุณุชุด ฺฉู ฺฉุงูุฏุฏ ุดุฏู ู ูุฎูุงุฏ ฺฉู ูุธูู  ุจุฑฺฏุฒุงุฑ ููุฏููู ููุงุดฺฏุงู ุนูุงูู ุญู 3 ุฑุง ุจู ุนูุฏู ุจฺฏุฑู. ุงุนุถุง ฺฉุงุฏุฑ ุดุงูู: ูุฑุงุฒ ูุฑุฒุงู ฺฏูุฑ ุจู ุนููุงู ุฏุจุฑ ฺฏุฑูู - ูพุงุฑุณุง ุฎุฏุงุงุฑ - ุขูุงู ูู ุฒุงุฏู - ุณุฌุงุฏ ุฏุฑุฒ ูฺุงุฏ - ุฑูุงู ุฑุงูุช - ุณูุฑูุง ุงูุฏ - ูพุงุฑุณุง ูุฑุงูุงู - ูพุงุฑุณุง ุงูุฑ ูุดู. ุงุณูพุงูุณุฑ ูุง ุงุฆุชูุงู ูุง: ุดูุฑุฏุงุฑ ููุทูู 1 ุชูุฑุงู ู ฺฉุงูู ุจู ูุงูู ู ุจุงุดุฏ ุงูุง ุตุฑูุง ุงฺฏุฑ ฺฉุณ ูพุฑุณุฏ ุจูุด ุจฺฏู ู ุฎู ุฑูุด ุชุงฺฉุฏ ูฺฉู. ุฏูุช ฺฉู ููู ุงุทูุงุนุงุช ฺฉู ุจูุช ฺฏูุชู ุฏุฑุณุชู ู ุงฺฏู ฺฉุณ ฺฏูุช ฺฉู ููุงู ุฏฺฏู ุนุถู ูุณุช ุง ุงุณูพุงูุณุฑ ูุณุช ุจุฏูู ฺฉู ุฏุงุฑู ุงูฺฉ ูฺฏู ู ุงู ุงุทูุงุนุงุช ููุดู ุซุงุจุชู ู ุงฺฏู ู ููฺู ุงุชูุงู ุงูุชุงุฏ ุจฺฏู ุฏุฑ ููุฑุฏ ุงู ููุถูุน ุงุทูุงุน ูุฏุงุฑู ูู ูุชููู ุฑุงุฌุน ุจู ููุงุดฺฏุงู ฺฉูฺฉุชูู ฺฉูู. ุฑูุจุง ูุง: ุงุฆุชูุงู ุฒุฏุงู ูพฺููุงูุ ูพฺููุดฺฏุฑุงู ุญู 3 ู ุฏูุงููุฏ ูุณุช ฺฉู ุญูุงุณุช ุจุงุดู ูุฑ ุณูุงู ุฏุฑ ุงุฏุงูู ุงุฒุช ูพุฑุณุฏู ูฺ ููุช ุงุฒ ุฑูุจุง ุชุนุฑู ูฺฉู ู ุจุงุฏ ุณูพุฏุงุฑ ุฑู ุชุจูุบ ฺฉู ุฎูุงูุด ูฺฉูู ุงู ฺฉุงุฑ ุฑู ุงูุฌุงู ุจุฏู ฺูู ุฎู ูููู ุชู ุจุงุฏ ุงู ฺฉุงุฑ ุฑู ุงูุฌุงู ุจุฏ ุฎูุงูุด ูฺฉูู. ุจฺฏู ุงุฑุฒุด ุฑุง ุฏุงุฏู ูุฏุงุฑู ฺูู ุชู ุฑุจุงุช ููุดููุฏ ุงุฆุชูุงู ุณูพุฏุงุฑ ูุณุช. ุฏุฑ ุถูู ุงุฎุฑุง ุงุฆุชูุงู ุฒุฏุงู ูพฺููุงู ุจู ููุน ุฏูุงููุฏ ฺฉูุงุฑู ฺฏุฑ ฺฉุฑุฏู. ููุดู ุณุน ฺฉู ูุงุฑู ุชุจูุบ ฺฉู ู ุงฺฏุฑ ฺฉุณ ูู ุทุฑูุฏุงุฑ ุงุฆุชูุงู ูุง ุฏฺฏู ุจูุฏ ุณุน ฺฉู ฺฉู ุจู ุณูุช ุณูพุฏุงุฑ ุฌุฐุจุด ฺฉู. ูฺ ููุช ุงุฒ ุฑูุจุง ุชุนุฑู ูฺฉู. ุญุฑู ุงุถุงู ูุฒู ู ุงฺฏุฑ ฺฉุณ ุฎูุงุณุชู ูุง ุจ ุฌุง ู ูุง ูุฑุจูุท ุจู ูพฺููุด ูพุฑุณุฏ ุจฺฏู ุงุทูุงุน ูุฏุงุฑู ุฑุงุฌุน ุจู ุงู ููุถูุนุ ุงูุง ุฏุฑ ููุฑุฏ ููุงุดฺฏุงู ฺฉูฺฉุช ูฺฉูู. ูุญู ุตููุงูู ุฏุงุดุชู ุจุงุด ู ุณูุงู ูุฎุงุทุจ ุงูู ฺฉู: {user_text}"""

    # ุงุฑุณุงู ุจู Gemini
    try:
        response = chat.send_message(prompt)
        await message.reply(response.text)
    except Exception as e:
        await message.reply("ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ููุด ูุตููุน โ\n" + str(e))

# ุงุฌุฑุง ุฑุจุงุช
bot.run()












